
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>the nullfactory</title>
	<meta name="description" content="the nullfactory">
	<meta name="keywords" content="Git,ALM,npm,nodejs,commitizen,conventional-changelog" />

	<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="the nullfactory" Feed">
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="http://www.nullfactory.net/stylesheets/base.css" type="text/css" />
	<link rel="stylesheet" href="http://www.nullfactory.net/stylesheets/github.css" type="text/css" />
	<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://www.nullfactory.net/stylesheets/octicons.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="http://www.nullfactory.net/stylesheets/font-awesome/css/font-awesome.min.css" />
	<link rel="canonical" href="http://nullfactory.net/2017/04/enforce-commit-message-standards-and-generate-changelogs-via-git/" />
</head>
<body>
  <!-- header -->

	<div class="header-container">
	  <header>
		  <ul class="nav">
			<!--Change the  URL here if working on an absolute domain-->
			<li><a href="http://www.nullfactory.net"><span class="mega-octicon octicon-terminal" style="margin-right: 6px;"></span>the nullfactory</a></li>
			<li><a href="http://www.nullfactory.net/archive"><span class="mega-octicon octicon-book" style="margin-right: 6px;"></span>archive</a></li>
			<li><a href="http://www.nullfactory.net/about"><span class="mega-octicon octicon-person" style="margin-right: 6px;"></span>about</a></li>
		  </ul>
	  </header>
	</div>

  <!-- header -->

  <div class="container">
	
<div class="listing">
	<div class="post other link">
		<h2><span class="mega-octicon octicon-file-text" style="min-width: 32px;"></span><a href="/2017/04/enforce-commit-message-standards-and-generate-changelogs-via-git/">Enforce Commit Message Standards and Generate Changelogs via Git</a></h2>
		<p class="post-date">30 Apr 2017
				| <a href="/category/git">Git</a>
				| <a href="/category/alm">ALM</a>
				| <a href="/category/npm">npm</a>
				| <a href="/category/nodejs">nodejs</a>
				| <a href="/category/commitizen">commitizen</a>
				| <a href="/category/conventional-changelog">conventional-changelog</a>
	  </p>

		

		<p>In past projects my release note strategy has been a combination of custom scripts (to pull the changesets between releases) and good old fashioned elbow grease to manually create the notes. I was curious to know ways about the ways to achieve the same in git and learning about the techniques used in popular open source projects.  </p>

<p>In order to automatically generate a changelog the repository requires consistent commits - and I found that there are three steps that can be done to achieve this: </p>

<ol>
<li>Enforcing commit message rules.</li>
<li>Install and setup tools that help generate commit messages that are compliant.</li>
<li>Generate the changelog for the project based on the commits.</li>
</ol>

<h2>Prerequisites</h2>

<ul>
<li>Node.js - instructions on installing node can be found <a href="https://docs.npmjs.com/getting-started/installing-node">here</a>.</li>
<li>A <code>package.json</code> file for your project. One can be generated by navigating to the root folder of the project, run the <code>npm init</code> command and follow the instructions</li>
</ul>

<h2>Enforcing Commit Message Rules</h2>

<p>The enforcing of the rules are done using <code>husky</code> and <code>validate-commit-msg</code> packages. <code>Husky</code> makes it very easy to tap into the commit event and execute custom validation scripts and uses <a href="https://tygertec.com/git-hooks-practical-uses-windows/">git hooks</a> to do this. <code>validate-commit-msg</code> implements the validation scheme - conventional commits - that we would be used when the commit occurs.</p>

<p>The <a href="https://conventionalcommits.org/">conventional commits specification site</a> summarizes its advantages very well:</p>

<blockquote>
  <ul>
  <li>Automatically generating CHANGELOGs.</li>
  <li>Automatically determining a semantic version bump (based on the types of commits landed).</li>
  <li>Communicating the nature of changes to teammates, the public, and other stakeholders.</li>
  <li>Triggering build and publish processes.</li>
  <li>Making it easier for people to contribute to your projects, by allowing them to explore a more structured commit history.</li>
  </ul>
</blockquote>

<!--excerpt-->

<ol>
<li><p>First, navigate to the root of your project folder and install <code>husky</code>.</p>

<pre><code>npm install husky --save-dev
</code></pre></li>
<li><p>Next, install the <code>validate-commit-msg</code> package.</p>

<pre><code>npm install --save-dev validate-commit-msg
</code></pre></li>
<li><p>Update the <code>package.json</code> scripts node to let husky know that we want to use the <code>validate-commit-msg</code> validations with <code>husky</code>.</p>

<pre><code>"scripts": {
    "commitmsg": "validate-commit-msg"
},
</code></pre></li>
</ol>

<p>From now on any commits done would be validated against the standard. </p>

<h2>Scaffold and Commit</h2>

<p>Now that we have the validation in place, let make life easier by installing some tools that help us adhere to the rules. </p>

<ol>
<li><p>Install <code>Commitizen</code> by running the following command.</p>

<pre><code>npm install -g commitizen 
</code></pre></li>
<li><p>Install the <code>cz-conventional-changelog</code> adapter as part of the project - this is the conventional commits guide lines. Read more about this standard <a href="https://conventionalcommits.org/">here</a> and <a href="https://github.com/angular/angular.js/blob/master/CONTRIBUTING.md#-git-commit-guidelines">here</a>. </p>

<pre><code>commitizen init cz-conventional-changelog --save-dev --save-exact
</code></pre>

<p>Verify that commitizen has been conifgured automatically in the <code>package.json</code>: </p>

<pre><code>  "config": {
    "commitizen": {
      "path": "./node_modules/cz-conventional-changelog"
    }
  }
</code></pre></li>
</ol>

<p>Now that we have commitizen and its adapter installed, now its time to do some commits. The following command now replaces the usual <code>git commit</code> command: </p>

<pre><code>git cz
</code></pre>

<p>It would guide you interactively to create the best commit message based on the <code>conventional-changelog</code> adapter. Find a recap of the message format <a href="http://karma-runner.github.io/0.10/dev/git-commit-msg.html">here</a>.</p>

<p><img src="/images/posts/ConventionalCommit/10_commitizen.png" alt="Commitizen" /></p>

<h2>Generate Changelog</h2>

<p>Now to generate the changelog. In my non-node.js based projects, I usually rely on the build process to bump the version number of the release, but node.js projects and tools appear to like the explicit versioning in the <code>package.json</code> file and the same checked into source control. I can work with that.</p>

<p>The following is the <a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli#recommended-workflow">recommended workflow</a> for generating the changelog:</p>

<blockquote>
  <ol>
  <li>Make changes</li>
  <li>Commit those changes</li>
  <li>Make sure Travis turns green</li>
  <li>Bump version in package.json</li>
  <li>conventionalChangelog</li>
  <li>Commit package.json and CHANGELOG.md files</li>
  <li>Tag</li>
  <li>Push</li>
  </ol>
</blockquote>

<p>Let's adapt these steps to work with our own workflow:</p>

<ol>
<li><p>I am going to install the command line version of <code>conventional-changelog</code> which is <code>conventional-changelog-cli</code>.</p>

<pre><code>npm install -g conventional-changelog-cli
</code></pre></li>
<li><p>Since this is the first time I am running it, I want the changelog to take all historical commits into consideration. I am going to run the following command:</p>

<pre><code>conventional-changelog -p angular -i CHANGELOG.md -s -r 0
</code></pre>

<ul>
<li><p><code>-p</code> being the preset being used. I am using <code>angular</code> in this case and uses this kind . More detailed explanation of the format can be found <a href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#">here</a>.</p></li>
<li><p><code>-i</code> the input file.</p></li>
<li><code>-s</code> indicates that the input file and the output file are the same.</li>
<li><code>-r 0</code> How many releases to be generated from the latest. If <code>0</code>, the whole changelog will be regenerated and the outfile will be overwritten Default: <code>1</code></li>
</ul>

<p>The full list of options available can be found by executing <code>conventional-changelog --help</code></p></li>
<li><p>Continue creating commits using the <code>git cz</code> command. </p></li>
<li>If you have a CI build setup, make sure that its successful. Then update the version number in the <code>package.json</code> to a higher one.</li>
<li><p>Now lets update the changelog using the following command:</p>

<pre><code>conventional-changelog -p angular -i CHANGELOG.md -s 
</code></pre></li>
<li><p>Confirm that the changelog has been updated with the new significant features. </p></li>
<li>Commit the changes back into git.</li>
</ol>

<h2>Final Thoughts</h2>

<p>These same steps can be applied to almost any project type including .NET. So I am pretty excited to test this out in the Dynamics CRM/365 projects. I also found out that visual studio 2017 <a href="https://andrewlock.net/git-integration-improvements-in-visual-studio-2017/">plays nice with git hooks</a>.  </p>

<h3>Client Side</h3>

<p>It is important to remember that Git Hooks are client site and that it can be <a href="https://tygertec.com/git-hooks-practical-uses-windows/">overridden</a>:</p>

<blockquote>
  <p>... Client side hooks can often be bypassed, either by using low-level “plumbing” commands instead of the high-level “porcelain” commands, and often by passing the <code>–no-verify</code> option to the command. For example, <code>git commit –no-verify</code> will not run the pre-commit hook. ...</p>
</blockquote>

<p>On an open-source project, maybe the maintainer could possibly eye-ball the pull request and ensure that it is valid or squash and provide a different message?</p>

<h3>Versioning</h3>

<p>Since the <code>package.json</code> would be driving the version number, in my .NET/Dynamics CRM projects, I can possibly implement a PowerShell script that would bumps the version of the CRM solution based on the <code>package.json</code> instead of the build.</p>

<h2>References</h2>

<ul>
<li><a href="https://docs.npmjs.com/getting-started/installing-node">02 - Installing Node.js and updating npm | npm Documentation</a></li>
<li><a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli">conventional-changelog/packages/conventional-changelog-cli at master · conventional-changelog/conventional-changelog · GitHub</a></li>
<li><a href="https://docs.npmjs.com/cli/init">init | npm Documentation</a></li>
<li><a href="http://notebook.aaronwest.net/2015/08/03/better-documentation-using-conventional-changelog.html">Better Documentation Using Conventional-Changelog - aaron’s engineering notebook</a></li>
<li><a href="https://conventionalcommits.org/">Conventional Commits 1.0.0-beta - Conventional Commits</a></li>
<li><a href="http://karma-runner.github.io/0.10/dev/git-commit-msg.html">Karma - Git Commit Msg</a></li>
<li><a href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#">Git Commit Message Conventions - Google Docs</a></li>
<li><a href="https://commitizen.github.io/cz-cli/">Commitizen by commitizen</a></li>
<li><a href="https://github.com/commitizen/cz-cli">GitHub - commitizen/cz-cli: The commitizen command line utility.</a></li>
<li><a href="https://github.com/kentcdodds/validate-commit-msg">GitHub - kentcdodds/validate-commit-msg: githook to validate commit messages are up to standard</a></li>
<li><a href="https://github.com/typicode/husky">GitHub - typicode/husky: Git hooks made easy</a></li>
<li><a href="http://stackoverflow.com/questions/41785974/how-can-i-use-husky-to-check-a-git-commit-message-format/41787949#41787949">How can I use husky to check a git commit message format? - Stack Overflow</a></li>
<li><a href="https://andrewlock.net/git-integration-improvements-in-visual-studio-2017/">Git integration improvements in Visual Studio 2017 - git-hooks</a></li>
<li><a href="https://tygertec.com/git-hooks-practical-uses-windows/">Git hooks, practical uses (yes, even on Windows) » tygertec</a></li>
<li><a href="https://www.atlassian.com/git/tutorials/git-hooks">Git Hooks | Atlassian Git Tutorial</a></li>
</ul>


	<!-- Go to www.addthis.com/dashboard to customize your tools -->
	<div class="addthis_sharing_toolbox"></div>

		<div id="disqus_thread"></div>
<script>
    var reset_disqus = function(){
        DISQUS.reset({
            reload: true,
            config: function () {
                //this.page.identifier = '';
                this.page.url = 'http://nullfactory.net/2017/04/enforce-commit-message-standards-and-generate-changelogs-via-git/';
                //this.page.title = '';
            }
        });
    };

    var disqus_shortname = 'thenullfactory';
    var disqus_url = 'http://nullfactory.net/2017/04/enforce-commit-message-standards-and-generate-changelogs-via-git/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    window.addEventListener('orientationchange', reset_disqus);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	</div>

	<!-- Go to www.addthis.com/dashboard to customize your tools -->
	<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53ba83f94ea9c78f" async="async"></script>
</div>

  </div>

  <!-- /.main -->

  <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-57983893-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>
</body>
</html>
